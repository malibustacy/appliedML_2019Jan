<!DOCTYPE html>
<html>
  <head>
    <title>Model Fitting</title>
    <meta charset="utf-8">
    <meta name="author" content="Applied Machine Learning with R www.therbootcamp.com @therbootcamp" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="baselrbootcamp.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Model Fitting
## With Regression
### Applied Machine Learning with R<br/><a href='https://therbootcamp.github.io'>www.therbootcamp.com</a><br/><a href='https://twitter.com/therbootcamp'><span class="citation">@therbootcamp</span></a>
### January 2019

---


layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;
&lt;a href="https://therbootcamp.github.io/"&gt;&lt;font color="#7E7E7E"&gt;Applied Machine Learning with R, January 2019&lt;/font&gt;&lt;/a&gt;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="https://therbootcamp.github.io/"&gt;&lt;font color="#7E7E7E"&gt;www.therbootcamp.com&lt;/font&gt;&lt;/a&gt;
&lt;/span&gt;&lt;/div&gt; 

---






# Where we are at

.pull-left4[

- Have a business &lt;high&gt;question&lt;/high&gt;:  How can I predict loan default?

- Have &lt;high&gt;data&lt;/high&gt; relevant to that question: Records from 300 historical customers.

- Data is cleaned and in a &lt;high&gt;tidy&lt;/high&gt;, rectangular format: Database, .csv.

&lt;br&gt;
### What's next?

&lt;high&gt;Select&lt;/high&gt; and &lt;high&gt;train&lt;/high&gt; model(s) depending on the &lt;high&gt;type of task&lt;/high&gt;

]

.pull-right55[
&lt;br2&gt;
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://cdn-images-1.medium.com/max/1600/1*_QGyIwpgq831xI54cIe_GQ.jpeg" alt="Source: Medium.com" width="100%" /&gt;
&lt;p class="caption"&gt;Source: Medium.com&lt;/p&gt;
&lt;/div&gt;

]


---

# What type of task do you have?

.pull-left45[

There are &lt;high&gt;many types of of ML tasks&lt;/high&gt;.

In this course, we will focus on 2 of the most popular

&lt;br&gt;

|Type|Description | Example |
|:----|:---- |:----|
|&lt;high&gt;Regression&lt;/high&gt; (supervised)|Predicting a number|Stock prices|
|&lt;high&gt;Classification&lt;/high&gt; (supervised)|Predicting a category, like whether|Whether someone will purchase a product or not|

]

.pull-right5[

&lt;img src="https://github.com/therbootcamp/appliedML_2019Jan/blob/master/_sessions/Fitting/image/class_v_regression.jpg?raw=true" width="100%" style="display: block; margin: auto;" /&gt;

]

---

.pull-left45[

# What ML models are there?

&lt;br&gt;
There are *thousands* of machine learning models

In this course, you will learn 3 of the most popular:

|Model|Description|
|:----|:---- |
|&lt;high&gt;Regression&lt;/high&gt;|A weighted linear combination of features and weights|
|&lt;high&gt;Decision Tree&lt;/high&gt;|A series of hierarchical 'yes/no' decisions|
|&lt;high&gt;Random Forests&lt;/high&gt;|Combination of many decision trees|


]

.pull-right5[
&lt;br&gt;&lt;br2&gt;
&lt;img src="https://github.com/therbootcamp/appliedML_2019Jan/blob/master/_sessions/Fitting/image/three_models_vert.jpg?raw=true" width="90%" style="display: block; margin: auto;" /&gt;

]

---
class: center, middle

## Once you have a model you need to "Fit" (aka, "Train") it to data.

&lt;font size=5&gt;&lt;high&gt;What does that mean?&lt;/high&gt;&lt;/font&gt;

&lt;br&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://afit-r.github.io/public/images/analytics/regression/sq.errors-1.png" alt="&amp;lt;font size = 3&amp;gt;James et al., Introduction to SL&amp;lt;/font&amp;gt;" width="50%" /&gt;
&lt;p class="caption"&gt;&lt;font size = 3&gt;James et al., Introduction to SL&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;




---

# What does "Fitting" mean?

.pull-left5[

For any model class, there is no "One" single model.

&gt; How many possible Regression models are there?

&lt;br2&gt;
Any machine learning model can be 'fit' (aka 'trained') on a specific dataset of interest. This means &lt;high&gt;finding the "best" version of a model&lt;/high&gt; for a specific dataset.

&gt; "Let me represent the data in the best way I can given how I work"&lt;br&gt;
&gt;~ Model during fitting

&lt;br2&gt;
The "best" model is usually defined as a combination of &lt;high&gt;accuracy&lt;/high&gt; (higher better!) and &lt;high&gt;complexity&lt;/high&gt; (simpler is better!)

]

.pull-right45[



&lt;p align="center"&gt;&lt;font size=5&gt;&lt;high&gt;How do I fit a model to these data?&lt;/font&gt;&lt;/high&gt;&lt;/p&gt;

&lt;img src="Fitting_files/figure-html/unnamed-chunk-7-1.png" width="80%" style="display: block; margin: auto;" /&gt;


]








---

# Defining Accuracy (or Error)


.pull-left45[

To train (fit) a model to a dataset, we need to &lt;high&gt;mathematically define Accuracy&lt;/high&gt;

Alternatively, we can define a model's &lt;high&gt;Error&lt;/high&gt;

There is &lt;high&gt;no 'correct'&lt;/high&gt; definition of error, it depends on &lt;high&gt;what's important to you&lt;/high&gt; as the decision maker!

Once accuracy (or error) is defined, a model can be trained to maximize (or minimize) it!

The model that minimizes error (or maximizes accuracy) is the final &lt;high&gt;Training model&lt;/high&gt;

]

.pull-right45[

&lt;p align="center"&gt;&lt;font size=5&gt;&lt;high&gt;How do I fit a model to these data?&lt;/font&gt;&lt;/high&gt;&lt;/p&gt;

&lt;img src="Fitting_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

# Which of these models is better? Why?

&lt;img src="Fitting_files/figure-html/unnamed-chunk-10-1.png" width="90%" style="display: block; margin: auto;" /&gt;


---

# Which of these models is better? Why?

&lt;img src="Fitting_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;" /&gt;


---

# Regression Error

.pull-left45[

#### MAE: Mean Absolute Error

`$$\large MAE = \frac{1}{n}\sum_{i=1}^{n} \lvert Prediction_{i} - Truth_{i} \rvert$$`

&gt; On average, how far are predictions away from true values?


#### MSE: Mean Squared Error

`$$\large MSE = \frac{1}{n}\sum_{i=1}^{n}(Prediction_{i} - Truth_{i})^{2}$$`
&gt; On average, how far are predictions away from true values (squared!)?


]

.pull-right5[

&lt;img src="Fitting_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" /&gt;

]






---

.pull-left45[

# Classification Accuracy

Classification accuracy measures all come from the &lt;high&gt; "confusion matrix"&lt;/high&gt;

The confusion matrix is a cross tabulation table showing predictions versus true classes.

#### Confusion Matrix

|    |      Y is Positive      | Y is Negative |
|--------------|:-------------:|:------:|
| Predict &lt;br&gt;"Positive"| &lt;font color = "#6ABA9A"&gt;TP&lt;br&gt; True Positive&lt;/font&gt;| &lt;font color = "#EA4B68"&gt;FP &lt;br&gt; False Positive&lt;/font&gt; |
| Predict &lt;br&gt;"Negative"|    &lt;font color = "#EA4B68"&gt;FN&lt;br&gt; False Negative&lt;/font&gt;   |  &lt;font color = "#6ABA9A"&gt;TN &lt;br&gt; True Negative&lt;/font&gt;|

&lt;i&gt;Note: Green cells are &lt;font color = "#6ABA9A"&gt;correct decisions&lt;/font&gt; while Red cells are &lt;font color = "#EA4B68"&gt;incorrect decisions&lt;/font&gt;&lt;/i&gt;


]

.pull-right5[

&lt;br&gt;

#### Data

||X1|X2|X3|Prediction|Truth|Outcome|
|:---|:----|:----|:----|:----|:----|:----|
|1|.|.|.|"Default"|Default|&lt;font color = "#6ABA9A"&gt;TP&lt;/font&gt;|
|2|.|.|.|"Default"|Default|&lt;font color = "#6ABA9A"&gt;TP&lt;/font&gt;|
|3|.|.|.|"Repay"|Repay|&lt;font color = "#6ABA9A"&gt;TN&lt;/font&gt;|
|4|.|.|.|"Default"|Repay|&lt;font color = "#EA4B68"&gt;FP&lt;/font&gt;|
|5|.|.|.|"Repay"|Default|&lt;font color = "#EA4B68"&gt;FN&lt;/font&gt;|
|6|.|.|.|"Default"|Default|&lt;font color = "#6ABA9A"&gt;TP&lt;/font&gt;|
|7|.|.|.|"Repay"|Repay|&lt;font color = "#6ABA9A"&gt;TN&lt;/font&gt;|

#### Confusion Matrix

|                  |      True Default      | True Repay  |
|------------------|:-------------:|:------:|
| "Default"| &lt;font color = "#6ABA9A"&gt;3&lt;/font&gt;| &lt;font color = "#EA4B68"&gt;1 &lt;/font&gt; |
| "Repay"|    &lt;font color = "#EA4B68"&gt;1&lt;/font&gt;   |  &lt;font color = "#6ABA9A"&gt; 2&lt;/font&gt;|

]

---

.pull-left45[

# Classification Accuracy

Classification accuracy measures all come from the &lt;high&gt; "confusion matrix"&lt;/high&gt;

The confusion matrix is a cross tabulation table showing predictions versus true classes.

#### Confusion Matrix

|                       |      Y is Positive      | Y is Negative |
|-----------------------|:-------------:|:------:|
| Predict &lt;br&gt;"Positive"| &lt;font color = "#6ABA9A"&gt;TP&lt;br&gt; True Positive&lt;/font&gt;| &lt;font color = "#EA4B68"&gt;FP &lt;br&gt; False Positive&lt;/font&gt; |
| Predict &lt;br&gt;"Negative"|    &lt;font color = "#EA4B68"&gt;FN&lt;br&gt; False Negative&lt;/font&gt;   |  &lt;font color = "#6ABA9A"&gt;TN &lt;br&gt; True Negative&lt;/font&gt;|

&lt;i&gt;Note: Green cells are &lt;font color = "#6ABA9A"&gt;correct decisions&lt;/font&gt; while Red cells are &lt;font color = "#EA4B68"&gt;incorrect decisions&lt;/font&gt;&lt;/i&gt;


]

.pull-right5[

&lt;br&gt;
#### Overall Accuracy

&gt; What percent of my predictions are correct?

`$$\large Overall \; Accuracy = \frac{TP + TN}{ TP + TN + FN + FP}$$`

#### Sensitivity

&gt; &lt;i&gt;Of the truly Positive cases&lt;/i&gt;, what percent of predictions are correct?


`$$\large Sensitivity = \frac{TP}{ TP +FN }$$`
#### Specificity

&gt; &lt;i&gt;Of the truly Negative cases&lt;/i&gt;, what percent of predictions are correct?

`$$\large Specificity = \frac{TN}{ TN + FP }$$`


]



---

.pull-left45[

# Classification Accuracy

### Example: Loan default

Imagine we use a model (e.g. a decision tree) to predict whether or not each of 7 customers will default on their loan.

After the loan period is over, we obtain the final confusion matrix comparing our predictions to the truth:

### Confusion Matrix

|                     |      True Default      | True Repay  |
|---------------------|:-------------:|:------:|
| Predict &lt;br&gt;"Default"| &lt;font color = "#6ABA9A"&gt;TP &lt;br&gt;3&lt;/font&gt;| &lt;font color = "#EA4B68"&gt;FP &lt;br&gt;1 &lt;/font&gt; |
| Predict &lt;br&gt;"Repay"|    &lt;font color = "#EA4B68"&gt;FN&lt;br&gt;1&lt;/font&gt;   |  &lt;font color = "#6ABA9A"&gt;TN &lt;br&gt; 2&lt;/font&gt;|

]

.pull-right5[

&lt;br&gt;

#### Overall Accuracy

Across all customers, our model has an accuracy of 71%

`$$\large Overall \; Accuracy = \frac{3 + 2}{3 + 2 + 1 + 1} = 0.71$$`

#### Sensitivity

Our model is 75% accurate in catching true defaults

`$$\large Sensitivity = \frac{3}{3 + 4} = .75$$`
#### Specificity

Our model is 67% accurate in catching true repayments


`$$\large Specificity = \frac{2}{ 2 + 1 }= 0.67$$`


]


---

.pull-left45[

# Ready to fit!

Now we're ready to fit models to data!

In this course will cover three commonly used models, &lt;high&gt;Regression&lt;/high&gt;, &lt;high&gt;Decision Trees&lt;/high&gt;, and &lt;high&gt;Random Forest&lt;/high&gt;.

These models can be used in both regression and classification tasks.

As you'll see, they differ in complexity in important regards.

|Model|Complexity|
|:----|:---- |
|Regression|&lt;font color = "#EACC48"&gt;Medium&lt;/font&gt;|
|Decision Tree|&lt;font color = "#6ABA9A"&gt;Low&lt;/font&gt; (usually)|
|Random Forests|&lt;font color = "#EA4B68"&gt;High&lt;/font&gt;|

]

.pull-right5[
&lt;br&gt;
&lt;img src="https://github.com/therbootcamp/appliedML_2019Jan/blob/master/_sessions/Fitting/image/three_models_vert.jpg?raw=true" width="90%" style="display: block; margin: auto;" /&gt;

]


---

# Model Training (aka fitting)

&lt;img src="image/model_training_flow.png" width="1442" style="display: block; margin: auto;" /&gt;

---
class: center, middle

&lt;high&gt;&lt;h1&gt;Regression&lt;/h1&gt;&lt;/high&gt;

&lt;font color = "gray"&gt;&lt;h1&gt;Decision Trees&lt;/h1&gt;&lt;/font&gt;

&lt;font color = "gray"&gt;&lt;h1&gt;Random Forests&lt;/h1&gt;&lt;/font&gt;


---

# Regression

.pull-left4[

In [regression](https://en.wikipedia.org/wiki/Regression_analysis), the criterion Y is modeled as the &lt;high&gt;sum&lt;/high&gt; of &lt;high&gt;predictors times weights&lt;/high&gt; `\(\beta_{1}\)`, `\(\beta_{2}\)`&lt;/high&gt;.

`$$\hat{Y} =  \beta_{0} + X1 \times \beta_{X1} + X2 \times \beta_{X2} + ...$$`
&lt;br&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://afit-r.github.io/public/images/analytics/regression/sq.errors-1.png" alt="&amp;lt;font size = 3&amp;gt;James et al., Introduction to SL&amp;lt;/font&amp;gt;" width="100%" /&gt;
&lt;p class="caption"&gt;&lt;font size = 3&gt;James et al., Introduction to SL&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;

]

.pull-right55[

#### Interpretation

`$$\LARGE \hat{Y} =  \beta_{0} + X1 \times \beta_{X1} + X2 \times \beta_{X2} + ...$$`

Each beta weight `\(\beta_{i}\)` can be interpreted as:

&lt;q&gt;As the value of `\(X_{i}\)` increases by 1, how does the criterion `\(Y\)` change?&lt;/q&gt;

The more extreme `\(\beta_{i}\)` is (either positive or negative), the more `\(X_{i}\)` is used to predict the criterion `\(Y\)` (Note: take into account the scale of `\(X_{i}\)`!).

If a value of `\(\beta_{i}\)` is exactly 0, that means `\(X_{i}\)` does not help us predict the criterion `\(Y\)`






]

---

# Regression

.pull-left4[

In [regression](https://en.wikipedia.org/wiki/Regression_analysis), the criterion Y is modeled as the &lt;high&gt;sum&lt;/high&gt; of &lt;high&gt;predictors times weights&lt;/high&gt; `\(\beta_{1}\)`, `\(\beta_{2}\)`&lt;/high&gt;.

`$$\hat{Y} =  \beta_{0} + X1 \times \beta_{X1} + X2 \times \beta_{X2} + ...$$`
&lt;br&gt;

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://afit-r.github.io/public/images/analytics/regression/sq.errors-1.png" alt="&amp;lt;font size = 3&amp;gt;James et al., Introduction to SL&amp;lt;/font&amp;gt;" width="100%" /&gt;
&lt;p class="caption"&gt;&lt;font size = 3&gt;James et al., Introduction to SL&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;

]

.pull-right55[

### Sales Example

&lt;img src="image/Carseats_ss.jpg" width="100%" style="display: block; margin: auto;" /&gt;


&lt;u&gt;Regression Model&lt;/u&gt;

`$$\large Sales =  \beta_{0} + CompPrice \times \beta_{CompPrice} + Income \times \beta_{Income} + ...$$`
&lt;u&gt;Estimates&lt;/u&gt;

`$$\large Sales =  10 + CompPrice \times 5.4 + Income \times  1.3 + ...$$`

]



---
class: center,  middle

&lt;br&gt;&lt;br&gt;

# Let's fit regression models with caret!

&lt;img src="https://3qeqpr26caki16dnhd19sv6by6v-wpengine.netdna-ssl.com/wp-content/uploads/2014/09/Caret-package-in-R.png" width="70%" style="display: block; margin: auto;" /&gt;





---


.pull-left4[

# `caret`

&lt;u&gt;Main caret fitting functions&lt;/u&gt;

| Function| Purpose|
|--------|----------|
| [trainControl()](http://topepo.github.io/caret/model-training-and-tuning.html#basic-parameter-tuning) | Determine how training (in general) will be done|
| [train()](http://topepo.github.io/caret/model-training-and-tuning.html#model-training-and-parameter-tuning) | Specify a model and find *best* parameters|
| predict() | Predict values (either fitted values or predictions for new data)|
| [postResample()](http://topepo.github.io/caret/measuring-performance.html) | Evaluate model performance (fitting or prediction)|

]

.pull-right5[

&lt;br&gt;


```r
# Step 1: Load data
#   read_csv()

data_train &lt;- read_csv(...)

# Step 2: Define control parameters
#   trainControl()

ctrl &lt;- trainControl(...) 

# Step 3: Train and explore model
#   train()

mod &lt;- train(...)
summary(mod)
mod$finalModel   # see final model

# Step 4: Assess fit
#   predict(), postResample()

fit &lt;- predict()
postResample(fit, truth)

# Step 5: Visualise results

ggplot(...)
```



&lt;!-- Caret documentation: [http://topepo.github.io/caret/](http://topepo.github.io/caret/) --&gt;

&lt;!-- &lt;iframe src="http://topepo.github.io/caret/" height="480px" width = "500px"&gt;&lt;/iframe&gt; --&gt;

]

---

# `trainControl()`

.pull-left55[

Use `trainControl()` to define how `caret` should, generally, &lt;high&gt;select the best parameters&lt;/high&gt; for an ML model.

Here you can tell `caret` to do things like repeated &lt;high&gt;cross validation&lt;/high&gt; (which we will learn about later).

|Argument|Description|
|:-----|:----|
|`method`|How should fitting be done?|

For now, we'll set `method = "none"` to keep things simple to &lt;high&gt;fit the model without advanced parameter tuning&lt;/high&gt;.


```r
# Fit the model without any 
#  advanced parameter tuning methods

ctrl &lt;- trainControl(method = "none")
```

]

.pull-right4[


```r
?trainControl
```

&lt;img src="image/traincontrol_help.jpg" width="100%" style="display: block; margin: auto;" /&gt;

]

---

# `train()`

.pull-left4[

`train()` is the workhorse fitting function of `caret`.

With just this one function, you can &lt;high&gt;fit any of 200+ models&lt;/high&gt; just by changing the &lt;high&gt;method&lt;/high&gt; argument!


|Argument|Description|
|:-----|:----|
|`form`|Formula specifying criterion|
|`data`|Training data|
|`method`| Model|
|`trControl`| Control parameters|

]


.pull-right55[

#### Train a Regression model

Regression: `method = "glm"`


```r
# Fit a regression model predicting Price

mod &lt;- train(form = income ~ ., # Formula
             data = baselers,   # Training data
             method = "glm",    # Regression
             trControl = ctrl)  # Control Parameters
```


]


---

# `train()`

.pull-left4[

`train()` is the workhorse fitting function of `caret`.

With just this one function, you can &lt;high&gt;fit any of 200+ models&lt;/high&gt; just by changing the &lt;high&gt;method&lt;/high&gt; argument!

|Argument|Description|
|:-----|:----|
|`form`|Formula specifying criterion|
|`data`|Training data|
|`method`| Model|
|`trControl`| Control parameters|
]


.pull-right55[

#### Train a Random Forest model

Random Forest: `method = "rf"`


```r
# Fit a Random Forest model predicting Price

mod &lt;- train(form = income ~ ., # Formula
             data = baselers,   # Training data
             method = "rf",     # Random Forests
             trControl = ctrl)  # Control Parameters
```

]


---

.pull-left4[

# `train()`

`train()` is the workhorse fitting function of `caret`.

With just this one function, you can &lt;high&gt;fit any of 200+ models&lt;/high&gt; just by changing the &lt;high&gt;method&lt;/high&gt; argument!

Find all 280+ models [here](http://topepo.github.io/caret/available-models.html).

]


.pull-right55[

&lt;br&gt;
&lt;img src="image/caret_models_ss.jpg" width="80%" style="display: block; margin: auto;" /&gt;


]

---
.pull-left4[

# `train()`

Make sure your criterion is the correct class for your type of modelling task

- Numeric criterion = Regression Task
- Factor criterion = Classification Task


```r
# My training data
Loans
```


```
# A tibble: 5 x 5
  Default   Age Gender Cards Education
    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;
1       0    45 M          3        11
2       1    36 F          2        14
3       0    76 F          5        12
4       1    25 M          2        17
5       1    36 F          3        12
```

See that the column Default is 0's and 1's, but is coded as numeric.

]

.pull-right55[

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

This code will think that Default is a continuous number, not a category (probably not what you want)


```r
# Will be a regression task if Default is numeric

mod &lt;- train(form = default ~ .,
             data = Loans,
             method = "glm",
             trControl = ctrl)
```

&lt;font color='red' size = 3&gt;Warning messages:...Are you sure you wanted to do regression?&lt;/font&gt;

Use `factor()` to &lt;high&gt;convert your criterion&lt;/high&gt; to a factor, now you are doing classification!


```r
# Will be a classification task

mod &lt;- train(form = factor(Default) ~ .,
             data = Loans,
             method = "glm")
```

]


---
.pull-left35[

# .$finalModel

The `train()` function returns a list with a key object called `finalModel` - this is your final machine learning model!

You can access the model with `mod$finalModel`, and explore the object with generic functions:


|Function|Description
|:------|:----|
|`summary()`| Overview of the most important information|
|`names()`|See all named elements you can access with $|

]

.pull-right6[

&lt;br&gt;

```r
# Create a regression object
mod &lt;- train(form = income ~ age + height + fitness,
             data = baselers)   # Training data

# Look at final model
mod$finalModel
# [...]
```





```r
# Look at all named outputs
names(mod$finalModel)
```

```
 [1] "coefficients"      "residuals"         "fitted.values"     "effects"           "R"                
 [6] "rank"              "qr"                "family"            "linear.predictors" "deviance"         
[11] "aic"               "null.deviance"     "iter"              "weights"           "prior.weights"    
[16] "df.residual"       "df.null"           "y"                 "converged"         "boundary"         
[21] "model"             "formula"           "terms"             "data"              "offset"           
[26] "control"           "method"            "contrasts"         "xlevels"           "xNames"           
[31] "problemType"       "tuneValue"         "obsLevels"         "param"            
```

```r
# Access specific outputs
mod$finalModel$coefficients
```

```
(Intercept)         age      height     fitness 
    136.606     151.751       3.381      11.012 
```


]



---

# `predict()`

.pull-left5[

The `predict()` function is allows you to return predictions from a model.

Put your model object as the first argument. If you don't specify a new dataset with `newdata`, the function returns &lt;high&gt;fitted values from training&lt;/high&gt;



```r
# Get fitted values
glm_fits &lt;- predict(object = mod)
```

The result is a vector


```r
# Result is a vector of fits
glm_fits[1:5]
```

```
   1    2    3    4    5 
5507 6971 6969 8643 5324 
```

]

.pull-right45[

#### Plot of fits versus Truth

If the model was perfect, all points would be on diagonal


&lt;img src="Fitting_files/figure-html/unnamed-chunk-36-1.png" style="display: block; margin: auto;" /&gt;


]

---

# `postResample()`

.pull-left5[

To calculate aggregate model performance, use `postResample()`

|Argument|Description|
|:----|:----|
|pred|Model predictions (or fits)|
|obs|The observed (true) values|

&lt;br&gt;


```r
# Assess performance with postResample()

postResample(pred = glm_fits, # Predictions 
             obs = baselers$income) # Truth
```

```
    RMSE Rsquared      MAE 
1172.905    0.821  936.994 
```



]

.pull-right45[

#### Plot of fits versus Truth

Red lines indicate absolute error(s)


&lt;img src="Fitting_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;

]

---

class: middle, center

&lt;h1&gt; Questions?&lt;/h1&gt;

&lt;h1&gt;&lt;a href=https://therbootcamp.github.io/appliedML_2019Jan/_sessions/Fitting/Fitting_practical.html&gt;Practical&lt;/a&gt;&lt;/h1&gt;
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
